{"ast":null,"code":"function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nimport React, { createRef, Component } from 'react';\nimport styled, { withTheme } from 'styled-components';\nimport { debounce, debounceDelay, selectedStyle, setFocusWithoutScroll } from '../../utils';\nimport { defaultProps } from '../../default-props';\nimport { Box } from '../Box';\nimport { Button } from '../Button';\nimport { InfiniteScroll } from '../InfiniteScroll';\nimport { Keyboard } from '../Keyboard';\nimport { Text } from '../Text';\nimport { TextInput } from '../TextInput';\nimport { StyledContainer } from './StyledSelect';\nimport { applyKey } from './utils'; // position relative is so scroll can be managed correctly\n\nvar OptionsBox = styled.div.withConfig({\n  displayName: \"SelectContainer__OptionsBox\",\n  componentId: \"sc-1wi0ul8-0\"\n})([\"position:relative;scroll-behavior:smooth;overflow:auto;\"]);\nvar OptionBox = styled(Box).withConfig({\n  displayName: \"SelectContainer__OptionBox\",\n  componentId: \"sc-1wi0ul8-1\"\n})([\"\", \"\"], function (props) {\n  return props.selected && selectedStyle;\n});\nvar SelectOption = styled(Button).withConfig({\n  displayName: \"SelectContainer__SelectOption\",\n  componentId: \"sc-1wi0ul8-2\"\n})([\"display:block;width:100%;\"]);\n\nvar SelectContainer = /*#__PURE__*/function (_Component) {\n  _inheritsLoose(SelectContainer, _Component);\n\n  function SelectContainer(props) {\n    var _this;\n\n    _this = _Component.call(this, props) || this;\n\n    _defineProperty(_assertThisInitialized(_this), \"searchRef\", createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"optionsRef\", createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"onSearchChange\", function (event) {\n      _this.setState({\n        search: event.target.value,\n        activeIndex: -1\n      }, function () {\n        var search = _this.state.search;\n\n        _this.onSearch(search);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSearch\", debounce(function (search) {\n      var onSearch = _this.props.onSearch;\n      onSearch(search);\n    }, debounceDelay(_this.props)));\n\n    _defineProperty(_assertThisInitialized(_this), \"selectOption\", function (index) {\n      return function (event) {\n        var _this$props = _this.props,\n            multiple = _this$props.multiple,\n            onChange = _this$props.onChange,\n            options = _this$props.options,\n            optionIndexesInValue = _this$props.optionIndexesInValue,\n            valueKey = _this$props.valueKey;\n\n        if (onChange) {\n          var nextValue;\n          var nextSelected;\n\n          if (multiple) {\n            var nextOptionIndexesInValue = optionIndexesInValue.slice(0);\n            var valueIndex = optionIndexesInValue.indexOf(index);\n\n            if (valueIndex === -1) {\n              nextOptionIndexesInValue.push(index);\n            } else {\n              nextOptionIndexesInValue.splice(index, 1);\n            }\n\n            nextValue = nextOptionIndexesInValue.map(function (i) {\n              return valueKey && valueKey.reduce ? applyKey(options[i], valueKey) : options[i];\n            });\n            nextSelected = nextOptionIndexesInValue;\n          } else {\n            nextValue = valueKey && valueKey.reduce ? applyKey(options[index], valueKey) : options[index];\n            nextSelected = index;\n          }\n\n          onChange(event, {\n            option: options[index],\n            value: nextValue,\n            selected: nextSelected\n          });\n        }\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"clearKeyboardNavigation\", function () {\n      clearTimeout(_this.keyboardNavTimer);\n      _this.keyboardNavTimer = setTimeout(function () {\n        _this.setState({\n          keyboardNavigating: false\n        });\n      }, 100); // 100ms was empirically determined\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onNextOption\", function (event) {\n      var options = _this.props.options;\n      var activeIndex = _this.state.activeIndex;\n      event.preventDefault();\n      var nextActiveIndex = activeIndex + 1;\n\n      while (nextActiveIndex < options.length && _this.isDisabled(nextActiveIndex)) {\n        nextActiveIndex += 1;\n      }\n\n      if (nextActiveIndex !== options.length) {\n        _this.setState({\n          activeIndex: nextActiveIndex,\n          keyboardNavigating: true\n        }, function () {\n          return _this.clearKeyboardNavigation();\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPreviousOption\", function (event) {\n      var activeIndex = _this.state.activeIndex;\n      event.preventDefault();\n      var nextActiveIndex = activeIndex - 1;\n\n      while (nextActiveIndex >= 0 && _this.isDisabled(nextActiveIndex)) {\n        nextActiveIndex -= 1;\n      }\n\n      if (nextActiveIndex >= 0) {\n        _this.setState({\n          activeIndex: nextActiveIndex,\n          keyboardNavigating: true\n        }, function () {\n          return _this.clearKeyboardNavigation();\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onActiveOption\", function (index) {\n      return function () {\n        var keyboardNavigating = _this.state.keyboardNavigating;\n\n        if (!keyboardNavigating) {\n          _this.setState({\n            activeIndex: index\n          });\n        }\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSelectOption\", function (event) {\n      var activeIndex = _this.state.activeIndex;\n\n      if (activeIndex >= 0) {\n        event.preventDefault(); // prevent submitting forms\n\n        _this.selectOption(activeIndex)(event);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"optionLabel\", function (index) {\n      var _this$props2 = _this.props,\n          options = _this$props2.options,\n          labelKey = _this$props2.labelKey;\n      return applyKey(options[index], labelKey);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"optionValue\", function (index) {\n      var _this$props3 = _this.props,\n          options = _this$props3.options,\n          valueKey = _this$props3.valueKey;\n      return applyKey(options[index], valueKey);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"isDisabled\", function (index) {\n      var _this$props4 = _this.props,\n          disabled = _this$props4.disabled,\n          disabledKey = _this$props4.disabledKey,\n          options = _this$props4.options;\n      var option = options[index];\n      var result;\n\n      if (disabledKey) {\n        result = applyKey(option, disabledKey);\n      } else if (Array.isArray(disabled)) {\n        if (typeof disabled[0] === 'number') {\n          result = disabled.indexOf(index) !== -1;\n        } else {\n          var optionValue = _this.optionValue(index);\n\n          result = disabled.indexOf(optionValue) !== -1;\n        }\n      }\n\n      return result;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"isSelected\", function (index) {\n      var _this$props5 = _this.props,\n          selected = _this$props5.selected,\n          value = _this$props5.value,\n          valueKey = _this$props5.valueKey;\n      var result;\n\n      if (selected) {\n        // deprecated in favor of value\n        result = selected.indexOf(index) !== -1;\n      } else {\n        var optionValue = _this.optionValue(index);\n\n        if (Array.isArray(value)) {\n          if (value.length === 0) {\n            result = false;\n          } else if (typeof value[0] !== 'object') {\n            result = value.indexOf(optionValue) !== -1;\n          } else if (valueKey) {\n            result = value.some(function (valueItem) {\n              var valueValue = typeof valueKey === 'function' ? valueKey(valueItem) : valueItem[valueKey];\n              return valueValue === optionValue;\n            });\n          }\n        } else if (valueKey && typeof value === 'object') {\n          var valueValue = typeof valueKey === 'function' ? valueKey(value) : value[valueKey];\n          result = valueValue === optionValue;\n        } else {\n          result = value === optionValue;\n        }\n      }\n\n      return result;\n    });\n\n    _this.state = {\n      search: '',\n      activeIndex: -1\n    };\n    return _this;\n  }\n\n  SelectContainer.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n    var options = nextProps.options,\n        optionIndexesInValue = nextProps.optionIndexesInValue,\n        onSearch = nextProps.onSearch;\n\n    if (onSearch) {\n      if (prevState.activeIndex === -1 && prevState.search === '' && options && optionIndexesInValue) {\n        var activeIndex = optionIndexesInValue.length ? optionIndexesInValue[0] : -1;\n        return {\n          activeIndex: activeIndex\n        };\n      }\n\n      if (prevState.activeIndex === -1 && prevState.search !== '') {\n        return {\n          activeIndex: 0\n        };\n      }\n    }\n\n    return null;\n  };\n\n  var _proto = SelectContainer.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    var _this2 = this;\n\n    var onSearch = this.props.onSearch; // timeout need to send the operation through event loop and allow\n    // time to the portal to be available\n\n    setTimeout(function () {\n      var optionsNode = _this2.optionsRef.current;\n\n      if (onSearch) {\n        var input = _this2.searchRef.current;\n\n        if (input && input.focus) {\n          setFocusWithoutScroll(input);\n        }\n      } else if (optionsNode) {\n        setFocusWithoutScroll(optionsNode);\n      }\n    }, 0);\n  };\n\n  _proto.render = function render() {\n    var _this3 = this;\n\n    var _this$props6 = this.props,\n        children = _this$props6.children,\n        dropHeight = _this$props6.dropHeight,\n        emptySearchMessage = _this$props6.emptySearchMessage,\n        id = _this$props6.id,\n        onMore = _this$props6.onMore,\n        onKeyDown = _this$props6.onKeyDown,\n        onSearch = _this$props6.onSearch,\n        options = _this$props6.options,\n        searchPlaceholder = _this$props6.searchPlaceholder,\n        theme = _this$props6.theme,\n        replace = _this$props6.replace;\n    var _this$state = this.state,\n        activeIndex = _this$state.activeIndex,\n        search = _this$state.search;\n    var customSearchInput = theme.select.searchInput;\n    var SelectTextInput = customSearchInput || TextInput;\n\n    var selectOptionsStyle = _extends({}, theme.select.options.box, {}, theme.select.options.container);\n\n    return React.createElement(Keyboard, {\n      onEnter: this.onSelectOption,\n      onUp: this.onPreviousOption,\n      onDown: this.onNextOption,\n      onKeyDown: onKeyDown\n    }, React.createElement(StyledContainer, {\n      as: Box,\n      id: id ? id + \"__select-drop\" : undefined,\n      dropHeight: dropHeight\n    }, onSearch && React.createElement(Box, {\n      pad: !customSearchInput ? 'xsmall' : undefined,\n      flex: false\n    }, React.createElement(SelectTextInput, {\n      focusIndicator: !customSearchInput,\n      size: \"small\",\n      ref: this.searchRef,\n      type: \"search\",\n      value: search,\n      placeholder: searchPlaceholder,\n      onChange: this.onSearchChange\n    })), React.createElement(OptionsBox, {\n      role: \"menubar\",\n      tabIndex: \"-1\",\n      ref: this.optionsRef\n    }, options.length > 0 ? React.createElement(InfiniteScroll, {\n      items: options,\n      step: theme.select.step,\n      onMore: onMore,\n      replace: replace,\n      show: activeIndex !== -1 ? activeIndex : undefined\n    }, function (option, index, optionRef) {\n      var isDisabled = _this3.isDisabled(index);\n\n      var isSelected = _this3.isSelected(index);\n\n      var isActive = activeIndex === index;\n      return React.createElement(SelectOption // eslint-disable-next-line react/no-array-index-key\n      , {\n        key: index,\n        ref: optionRef,\n        tabIndex: \"-1\",\n        role: \"menuitem\",\n        hoverIndicator: \"background\",\n        disabled: isDisabled || undefined,\n        active: isActive,\n        selected: isSelected,\n        option: option,\n        onMouseOver: !isDisabled ? _this3.onActiveOption(index) : undefined,\n        onClick: !isDisabled ? _this3.selectOption(index) : undefined\n      }, children ? children(option, index, options, {\n        active: isActive,\n        disabled: isDisabled,\n        selected: isSelected\n      }) : React.createElement(OptionBox, _extends({}, selectOptionsStyle, {\n        selected: isSelected\n      }), React.createElement(Text, theme.select.options.text, _this3.optionLabel(index))));\n    }) : React.createElement(SelectOption, {\n      key: \"search_empty\",\n      tabIndex: \"-1\",\n      role: \"menuitem\",\n      hoverIndicator: \"background\",\n      disabled: true,\n      option: emptySearchMessage\n    }, React.createElement(OptionBox, selectOptionsStyle, React.createElement(Text, theme.select.container.text, emptySearchMessage))))));\n  };\n\n  return SelectContainer;\n}(Component);\n\n_defineProperty(SelectContainer, \"defaultProps\", {\n  children: null,\n  disabled: undefined,\n  emptySearchMessage: 'No matches found',\n  id: undefined,\n  multiple: false,\n  name: undefined,\n  onKeyDown: undefined,\n  onSearch: undefined,\n  options: undefined,\n  searchPlaceholder: undefined,\n  selected: undefined,\n  value: '',\n  replace: true\n});\n\nObject.setPrototypeOf(SelectContainer.defaultProps, defaultProps);\nvar SelectContainerWrapper = withTheme(SelectContainer);\nexport { SelectContainerWrapper as SelectContainer };","map":{"version":3,"sources":["/Users/n/my-app/node_modules/grommet/es6/components/Select/SelectContainer.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_assertThisInitialized","self","ReferenceError","_inheritsLoose","subClass","superClass","create","constructor","__proto__","_defineProperty","obj","value","defineProperty","enumerable","configurable","writable","React","createRef","Component","styled","withTheme","debounce","debounceDelay","selectedStyle","setFocusWithoutScroll","defaultProps","Box","Button","InfiniteScroll","Keyboard","Text","TextInput","StyledContainer","applyKey","OptionsBox","div","withConfig","displayName","componentId","OptionBox","props","selected","SelectOption","SelectContainer","_Component","_this","event","setState","search","activeIndex","state","onSearch","index","_this$props","multiple","onChange","options","optionIndexesInValue","valueKey","nextValue","nextSelected","nextOptionIndexesInValue","slice","valueIndex","indexOf","push","splice","map","reduce","option","clearTimeout","keyboardNavTimer","setTimeout","keyboardNavigating","preventDefault","nextActiveIndex","isDisabled","clearKeyboardNavigation","selectOption","_this$props2","labelKey","_this$props3","_this$props4","disabled","disabledKey","result","Array","isArray","optionValue","_this$props5","some","valueItem","valueValue","getDerivedStateFromProps","nextProps","prevState","_proto","componentDidMount","_this2","optionsNode","optionsRef","current","input","searchRef","focus","render","_this3","_this$props6","children","dropHeight","emptySearchMessage","id","onMore","onKeyDown","searchPlaceholder","theme","replace","_this$state","customSearchInput","select","searchInput","SelectTextInput","selectOptionsStyle","box","container","createElement","onEnter","onSelectOption","onUp","onPreviousOption","onDown","onNextOption","as","undefined","pad","flex","focusIndicator","size","ref","type","placeholder","onSearchChange","role","tabIndex","items","step","show","optionRef","isSelected","isActive","hoverIndicator","active","onMouseOver","onActiveOption","onClick","text","optionLabel","name","setPrototypeOf","SelectContainerWrapper"],"mappings":"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","sourcesContent":["function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { createRef, Component } from 'react';\nimport styled, { withTheme } from 'styled-components';\nimport { debounce, debounceDelay, selectedStyle, setFocusWithoutScroll } from '../../utils';\nimport { defaultProps } from '../../default-props';\nimport { Box } from '../Box';\nimport { Button } from '../Button';\nimport { InfiniteScroll } from '../InfiniteScroll';\nimport { Keyboard } from '../Keyboard';\nimport { Text } from '../Text';\nimport { TextInput } from '../TextInput';\nimport { StyledContainer } from './StyledSelect';\nimport { applyKey } from './utils'; // position relative is so scroll can be managed correctly\n\nvar OptionsBox = styled.div.withConfig({\n  displayName: \"SelectContainer__OptionsBox\",\n  componentId: \"sc-1wi0ul8-0\"\n})([\"position:relative;scroll-behavior:smooth;overflow:auto;\"]);\nvar OptionBox = styled(Box).withConfig({\n  displayName: \"SelectContainer__OptionBox\",\n  componentId: \"sc-1wi0ul8-1\"\n})([\"\", \"\"], function (props) {\n  return props.selected && selectedStyle;\n});\nvar SelectOption = styled(Button).withConfig({\n  displayName: \"SelectContainer__SelectOption\",\n  componentId: \"sc-1wi0ul8-2\"\n})([\"display:block;width:100%;\"]);\n\nvar SelectContainer =\n/*#__PURE__*/\nfunction (_Component) {\n  _inheritsLoose(SelectContainer, _Component);\n\n  function SelectContainer(props) {\n    var _this;\n\n    _this = _Component.call(this, props) || this;\n\n    _defineProperty(_assertThisInitialized(_this), \"searchRef\", createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"optionsRef\", createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"onSearchChange\", function (event) {\n      _this.setState({\n        search: event.target.value,\n        activeIndex: -1\n      }, function () {\n        var search = _this.state.search;\n\n        _this.onSearch(search);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSearch\", debounce(function (search) {\n      var onSearch = _this.props.onSearch;\n      onSearch(search);\n    }, debounceDelay(_this.props)));\n\n    _defineProperty(_assertThisInitialized(_this), \"selectOption\", function (index) {\n      return function (event) {\n        var _this$props = _this.props,\n            multiple = _this$props.multiple,\n            onChange = _this$props.onChange,\n            options = _this$props.options,\n            optionIndexesInValue = _this$props.optionIndexesInValue,\n            valueKey = _this$props.valueKey;\n\n        if (onChange) {\n          var nextValue;\n          var nextSelected;\n\n          if (multiple) {\n            var nextOptionIndexesInValue = optionIndexesInValue.slice(0);\n            var valueIndex = optionIndexesInValue.indexOf(index);\n\n            if (valueIndex === -1) {\n              nextOptionIndexesInValue.push(index);\n            } else {\n              nextOptionIndexesInValue.splice(index, 1);\n            }\n\n            nextValue = nextOptionIndexesInValue.map(function (i) {\n              return valueKey && valueKey.reduce ? applyKey(options[i], valueKey) : options[i];\n            });\n            nextSelected = nextOptionIndexesInValue;\n          } else {\n            nextValue = valueKey && valueKey.reduce ? applyKey(options[index], valueKey) : options[index];\n            nextSelected = index;\n          }\n\n          onChange(event, {\n            option: options[index],\n            value: nextValue,\n            selected: nextSelected\n          });\n        }\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"clearKeyboardNavigation\", function () {\n      clearTimeout(_this.keyboardNavTimer);\n      _this.keyboardNavTimer = setTimeout(function () {\n        _this.setState({\n          keyboardNavigating: false\n        });\n      }, 100); // 100ms was empirically determined\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onNextOption\", function (event) {\n      var options = _this.props.options;\n      var activeIndex = _this.state.activeIndex;\n      event.preventDefault();\n      var nextActiveIndex = activeIndex + 1;\n\n      while (nextActiveIndex < options.length && _this.isDisabled(nextActiveIndex)) {\n        nextActiveIndex += 1;\n      }\n\n      if (nextActiveIndex !== options.length) {\n        _this.setState({\n          activeIndex: nextActiveIndex,\n          keyboardNavigating: true\n        }, function () {\n          return _this.clearKeyboardNavigation();\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPreviousOption\", function (event) {\n      var activeIndex = _this.state.activeIndex;\n      event.preventDefault();\n      var nextActiveIndex = activeIndex - 1;\n\n      while (nextActiveIndex >= 0 && _this.isDisabled(nextActiveIndex)) {\n        nextActiveIndex -= 1;\n      }\n\n      if (nextActiveIndex >= 0) {\n        _this.setState({\n          activeIndex: nextActiveIndex,\n          keyboardNavigating: true\n        }, function () {\n          return _this.clearKeyboardNavigation();\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onActiveOption\", function (index) {\n      return function () {\n        var keyboardNavigating = _this.state.keyboardNavigating;\n\n        if (!keyboardNavigating) {\n          _this.setState({\n            activeIndex: index\n          });\n        }\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSelectOption\", function (event) {\n      var activeIndex = _this.state.activeIndex;\n\n      if (activeIndex >= 0) {\n        event.preventDefault(); // prevent submitting forms\n\n        _this.selectOption(activeIndex)(event);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"optionLabel\", function (index) {\n      var _this$props2 = _this.props,\n          options = _this$props2.options,\n          labelKey = _this$props2.labelKey;\n      return applyKey(options[index], labelKey);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"optionValue\", function (index) {\n      var _this$props3 = _this.props,\n          options = _this$props3.options,\n          valueKey = _this$props3.valueKey;\n      return applyKey(options[index], valueKey);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"isDisabled\", function (index) {\n      var _this$props4 = _this.props,\n          disabled = _this$props4.disabled,\n          disabledKey = _this$props4.disabledKey,\n          options = _this$props4.options;\n      var option = options[index];\n      var result;\n\n      if (disabledKey) {\n        result = applyKey(option, disabledKey);\n      } else if (Array.isArray(disabled)) {\n        if (typeof disabled[0] === 'number') {\n          result = disabled.indexOf(index) !== -1;\n        } else {\n          var optionValue = _this.optionValue(index);\n\n          result = disabled.indexOf(optionValue) !== -1;\n        }\n      }\n\n      return result;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"isSelected\", function (index) {\n      var _this$props5 = _this.props,\n          selected = _this$props5.selected,\n          value = _this$props5.value,\n          valueKey = _this$props5.valueKey;\n      var result;\n\n      if (selected) {\n        // deprecated in favor of value\n        result = selected.indexOf(index) !== -1;\n      } else {\n        var optionValue = _this.optionValue(index);\n\n        if (Array.isArray(value)) {\n          if (value.length === 0) {\n            result = false;\n          } else if (typeof value[0] !== 'object') {\n            result = value.indexOf(optionValue) !== -1;\n          } else if (valueKey) {\n            result = value.some(function (valueItem) {\n              var valueValue = typeof valueKey === 'function' ? valueKey(valueItem) : valueItem[valueKey];\n              return valueValue === optionValue;\n            });\n          }\n        } else if (valueKey && typeof value === 'object') {\n          var valueValue = typeof valueKey === 'function' ? valueKey(value) : value[valueKey];\n          result = valueValue === optionValue;\n        } else {\n          result = value === optionValue;\n        }\n      }\n\n      return result;\n    });\n\n    _this.state = {\n      search: '',\n      activeIndex: -1\n    };\n    return _this;\n  }\n\n  SelectContainer.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n    var options = nextProps.options,\n        optionIndexesInValue = nextProps.optionIndexesInValue,\n        onSearch = nextProps.onSearch;\n\n    if (onSearch) {\n      if (prevState.activeIndex === -1 && prevState.search === '' && options && optionIndexesInValue) {\n        var activeIndex = optionIndexesInValue.length ? optionIndexesInValue[0] : -1;\n        return {\n          activeIndex: activeIndex\n        };\n      }\n\n      if (prevState.activeIndex === -1 && prevState.search !== '') {\n        return {\n          activeIndex: 0\n        };\n      }\n    }\n\n    return null;\n  };\n\n  var _proto = SelectContainer.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    var _this2 = this;\n\n    var onSearch = this.props.onSearch; // timeout need to send the operation through event loop and allow\n    // time to the portal to be available\n\n    setTimeout(function () {\n      var optionsNode = _this2.optionsRef.current;\n\n      if (onSearch) {\n        var input = _this2.searchRef.current;\n\n        if (input && input.focus) {\n          setFocusWithoutScroll(input);\n        }\n      } else if (optionsNode) {\n        setFocusWithoutScroll(optionsNode);\n      }\n    }, 0);\n  };\n\n  _proto.render = function render() {\n    var _this3 = this;\n\n    var _this$props6 = this.props,\n        children = _this$props6.children,\n        dropHeight = _this$props6.dropHeight,\n        emptySearchMessage = _this$props6.emptySearchMessage,\n        id = _this$props6.id,\n        onMore = _this$props6.onMore,\n        onKeyDown = _this$props6.onKeyDown,\n        onSearch = _this$props6.onSearch,\n        options = _this$props6.options,\n        searchPlaceholder = _this$props6.searchPlaceholder,\n        theme = _this$props6.theme,\n        replace = _this$props6.replace;\n    var _this$state = this.state,\n        activeIndex = _this$state.activeIndex,\n        search = _this$state.search;\n    var customSearchInput = theme.select.searchInput;\n    var SelectTextInput = customSearchInput || TextInput;\n\n    var selectOptionsStyle = _extends({}, theme.select.options.box, {}, theme.select.options.container);\n\n    return React.createElement(Keyboard, {\n      onEnter: this.onSelectOption,\n      onUp: this.onPreviousOption,\n      onDown: this.onNextOption,\n      onKeyDown: onKeyDown\n    }, React.createElement(StyledContainer, {\n      as: Box,\n      id: id ? id + \"__select-drop\" : undefined,\n      dropHeight: dropHeight\n    }, onSearch && React.createElement(Box, {\n      pad: !customSearchInput ? 'xsmall' : undefined,\n      flex: false\n    }, React.createElement(SelectTextInput, {\n      focusIndicator: !customSearchInput,\n      size: \"small\",\n      ref: this.searchRef,\n      type: \"search\",\n      value: search,\n      placeholder: searchPlaceholder,\n      onChange: this.onSearchChange\n    })), React.createElement(OptionsBox, {\n      role: \"menubar\",\n      tabIndex: \"-1\",\n      ref: this.optionsRef\n    }, options.length > 0 ? React.createElement(InfiniteScroll, {\n      items: options,\n      step: theme.select.step,\n      onMore: onMore,\n      replace: replace,\n      show: activeIndex !== -1 ? activeIndex : undefined\n    }, function (option, index, optionRef) {\n      var isDisabled = _this3.isDisabled(index);\n\n      var isSelected = _this3.isSelected(index);\n\n      var isActive = activeIndex === index;\n      return React.createElement(SelectOption // eslint-disable-next-line react/no-array-index-key\n      , {\n        key: index,\n        ref: optionRef,\n        tabIndex: \"-1\",\n        role: \"menuitem\",\n        hoverIndicator: \"background\",\n        disabled: isDisabled || undefined,\n        active: isActive,\n        selected: isSelected,\n        option: option,\n        onMouseOver: !isDisabled ? _this3.onActiveOption(index) : undefined,\n        onClick: !isDisabled ? _this3.selectOption(index) : undefined\n      }, children ? children(option, index, options, {\n        active: isActive,\n        disabled: isDisabled,\n        selected: isSelected\n      }) : React.createElement(OptionBox, _extends({}, selectOptionsStyle, {\n        selected: isSelected\n      }), React.createElement(Text, theme.select.options.text, _this3.optionLabel(index))));\n    }) : React.createElement(SelectOption, {\n      key: \"search_empty\",\n      tabIndex: \"-1\",\n      role: \"menuitem\",\n      hoverIndicator: \"background\",\n      disabled: true,\n      option: emptySearchMessage\n    }, React.createElement(OptionBox, selectOptionsStyle, React.createElement(Text, theme.select.container.text, emptySearchMessage))))));\n  };\n\n  return SelectContainer;\n}(Component);\n\n_defineProperty(SelectContainer, \"defaultProps\", {\n  children: null,\n  disabled: undefined,\n  emptySearchMessage: 'No matches found',\n  id: undefined,\n  multiple: false,\n  name: undefined,\n  onKeyDown: undefined,\n  onSearch: undefined,\n  options: undefined,\n  searchPlaceholder: undefined,\n  selected: undefined,\n  value: '',\n  replace: true\n});\n\nObject.setPrototypeOf(SelectContainer.defaultProps, defaultProps);\nvar SelectContainerWrapper = withTheme(SelectContainer);\nexport { SelectContainerWrapper as SelectContainer };"]},"metadata":{},"sourceType":"module"}